{% extends "base.html" %}
{% block content %}
<div class="row h-100" style="min-height:80vh;">
    <div class="col-md-4 border-end" style="overflow-y:auto;">
        <div class="p-3">
            <h4>Messages</h4>
            <input type="text" class="form-control form-control-sm" placeholder="Search conversations...">
        </div>
        <div>
            {% for u in users %}
            <a href="{{ url_for('chat', user_id=u.id) }}"
                class="d-flex align-items-center p-3 border-bottom text-decoration-none text-dark">
                <img src="{{ url_for('uploaded_file', filename=u.profile_pic) if u.profile_pic != 'default.jpg' else url_for('static', filename='img/default.jpg') }}"
                    class="rounded-circle me-3" style="width:50px; height:50px; object-fit:cover;">
                <div>
                    <strong>{{ u.name }}</strong><br>
                    <small class="text-muted">Sounds good! See you on the field.</small>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>

    <div class="col-md-8 d-flex flex-column">
        <div class="border-bottom p-3 d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <img src="{{ url_for('uploaded_file', filename=other_user.profile_pic) if other_user.profile_pic != 'default.jpg' else url_for('static', filename='img/default.jpg') }}"
                    class="rounded-circle me-3" style="width:45px; height:45px; object-fit:cover;">
                <div>
                    <strong>{{ other_user.name }}</strong><br>
                    <small class="text-success">Active now</small>
                </div>
            </div>
            <div>
                <button class="btn btn-link text-dark"><i class="fas fa-phone"></i></button>
                <button class="btn btn-link text-dark"><i class="fas fa-video"></i></button>
            </div>
        </div>

        <div class="flex-grow-1 p-3" style="overflow-y:auto; background:#f8f9fa;">
            {% for msg in messages %}
            {% set is_me = (msg.sender_id == current_user.id) %}
            <div class="d-flex mb-3 {% if is_me %}justify-content-end{% else %}justify-content-start{% endif %}">
                <div
                    style="max-width:70%; background:{{ '#5e35b1' if is_me else '#ffffff' }}; color:{{ '#fff' if is_me else '#000' }}; padding:0.75rem 1rem; border-radius:18px; box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                    {{ msg.content }}
                    <div class="small mt-1 opacity-75 text-end">{{ msg.timestamp.strftime('%I:%M %p') }}</div>
                </div>
            </div>
            {% endfor %}
        </div>

        <form method="POST" class="p-3 border-top bg-white">
            <div class="input-group">
                <input type="text" name="content" class="form-control" placeholder="Type your message here..." required>
                <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i></button>
            </div>
        </form>
    </div>
</div>
{% endblock %}